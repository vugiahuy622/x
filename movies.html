<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω Phim</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
</head>

<body>
    <div class="sidebar">
        <h2>üçø Cinema Admin</h2>
        <ul>
            <li><a href="trangadmin.html">Admin</a></li>
            <li><a href="movies.html" class="active">Phim</a></li>
            <li><a href="showtimes.html">Su·∫•t chi·∫øu</a></li>
            <li><a href="tickets.html">V√©</a></li>
            <li><a href="index.html" target="_blank">üåê Trang web ch√≠nh</a></li>
        </ul>
    </div>

    <div class="main">
        <div class="header">
            <h1>Qu·∫£n l√Ω phim</h1>
            <button class="logout">ƒêƒÉng xu·∫•t</button>
        </div>

        <!-- Form th√™m phim -->
        <div class="form-container">
            <h2>‚ûï Th√™m phim m·ªõi</h2>
            <input type="text" id="image" placeholder="Link ·∫£nh poster">
            <input type="text" id="name" placeholder="T√™n phim">
            <input type="text" id="genre" placeholder="Th·ªÉ lo·∫°i">
            <input type="text" id="duration" placeholder="Th·ªùi l∆∞·ª£ng (ph√∫t)">
            <button class="action-btn" id="saveButton">Th√™m phim</button>
            <span id="status"></span>
        </div><br>

        <!-- Danh s√°ch phim -->
        <div class="table-container">
            <h2>üìΩÔ∏è Danh s√°ch phim</h2>
            <table>
                <thead>
                    <tr>
                        <th>Poster</th>
                        <th>T√™n phim</th>
                        <th>Th·ªÉ lo·∫°i</th>
                        <th>Th·ªùi l∆∞·ª£ng</th>
                        <th>H√†nh ƒë·ªông</th>

                    </tr>
                </thead>
                <tbody id="movieList"></tbody>
            </table>
        </div>
    </div>

    <script>
        // Firebase config (thay b·∫±ng c·ªßa b·∫°n)
        const firebaseConfig = {
            apiKey: "AIzaSyDlne_gt7K1kWxTbBKcAD2Onvy7B8OUcaA",
            authDomain: "vghh-7999b.firebaseapp.com",
            projectId: "vghh-7999b",
            storageBucket: "vghh-7999b.firebasestorage.app",
            messagingSenderId: "374520262209",
            appId: "1:374520262209:web:7118e642efe315baa520c0",
            measurementId: "G-D3ZEDNBQ7C"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Th√™m phim
        document.getElementById("saveButton").addEventListener("click", () => {
            const name = document.getElementById("name").value.trim();
            const genre = document.getElementById("genre").value.trim();
            const duration = document.getElementById("duration").value.trim();
            const image = document.getElementById("image").value.trim();


            if (!name || !genre || !duration || !image) {
                alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin phim!");
                return;
            }

            db.collection("movies").doc(name).set({ name, genre, duration, image })
                .then(() => {
                    document.getElementById("status").innerText = "‚úÖ L∆∞u phim th√†nh c√¥ng!";
                    document.getElementById("name").value = "";
                    document.getElementById("genre").value = "";
                    document.getElementById("duration").value = "";
                    document.getElementById("image").value = "";
                    loadMovies();
                })
                .catch(err => document.getElementById("status").innerText = "‚ùå L·ªói: " + err.message);
        });

        // Hi·ªÉn th·ªã danh s√°ch phim
        function loadMovies() {
            db.collection("movies").get().then(snapshot => {
                const list = document.getElementById("movieList");
                list.innerHTML = "";
                snapshot.forEach(doc => {
                    const movie = doc.data();
                    const row = `
            <tr>
              <td><img src="${movie.image}" alt="poster" style="width:60px; border-radius:6px;"></td>
              <td>${movie.name}</td>
              <td>${movie.genre}</td>
              <td>${movie.duration} ph√∫t</td>
              <td>
                <button class="btn-edit" onclick="editMovie('${movie.name}', '${movie.genre}', '${movie.duration}', '${movie.image}')">S·ª≠a</button>
                <button class="btn-delete" onclick="deleteMovie('${movie.name}')">X√≥a</button>
              </td>
            </tr>`;
                    list.innerHTML += row;
                });
            });
        }

        // S·ª≠a phim
        function editMovie(name, genre, duration, image) {
            document.getElementById("name").value = name;
            document.getElementById("genre").value = genre;
            document.getElementById("duration").value = duration;
            document.getElementById("image").value = image;
            document.getElementById("status").innerText = "‚ö° ƒêang ch·ªânh s·ª≠a phim, b·∫•m 'Th√™m phim' ƒë·ªÉ c·∫≠p nh·∫≠t!";
        }

        // X√≥a phim
        function deleteMovie(name) {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a phim: " + name + " ?")) {
                db.collection("movies").doc(name).delete()
                    .then(() => {
                        document.getElementById("status").innerText = "üóëÔ∏è ƒê√£ x√≥a phim!";
                        loadMovies();
                    })
                    .catch(err => alert("L·ªói x√≥a: " + err.message));
            }
        }

        // Load phim khi m·ªü trang
        loadMovies();
    </script>
</body>

</html>