<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω Su·∫•t Chi·∫øu</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

</head>

<body>
    <div class="sidebar">
        <h2>üçø Cinema Admin</h2>
        <ul>
            <li><a href="trangadmin.html">Admin</a></li>
            <li><a href="movies.html">Phim</a></li>
            <li><a href="showtimes.html" class="active">Su·∫•t chi·∫øu</a></li>
            <li><a href="tickets.html">V√©</a></li>
            <li><a href="index.html" target="_blank">üåê Trang web ch√≠nh</a></li>
        </ul>
    </div>

    <div class="main">
        <div class="header">
            <h1>Qu·∫£n l√Ω Su·∫•t chi·∫øu</h1>
        </div>

        <!-- Form th√™m/s·ª≠a su·∫•t chi·∫øu -->
        <div class="form-container">
            <h2>Th√™m / C·∫≠p nh·∫≠t su·∫•t chi·∫øu</h2>
            <input type="hidden" id="showtimeId">
            <label>T√™n phim:</label>
            <input type="text" id="movieName">
            <label>Ng√†y:</label>
            <input type="date" id="date">
            <label>Gi·ªù:</label>
            <input type="time" id="time"><br>
            <label>Ph√≤ng : </label>
            <input type="text" id="room">
            <label>Gi√° v√©:</label>
            <input type="number" id="price">

            <button class="action-btn" id="saveBtn">L∆∞u</button>
        </div>

        <!-- B·∫£ng danh s√°ch su·∫•t chi·∫øu -->
        <div class="table-container">
            <h2>Danh s√°ch su·∫•t chi·∫øu</h2>
            <table>
                <thead>
                    <tr>
                        <th>Phim</th>
                        <th>Ng√†y</th>
                        <th>Gi·ªù</th>
                        <th>Ph√≤ng</th>
                        <th>Gi√° v√©</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody id="showtimeTable"></tbody>
            </table>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyDlne_gt7K1kWxTbBKcAD2Onvy7B8OUcaA",
            authDomain: "vghh-7999b.firebaseapp.com",
            projectId: "vghh-7999b",
            storageBucket: "vghh-7999b.firebasestorage.app",
            messagingSenderId: "374520262209",
            appId: "1:374520262209:web:7118e642efe315baa520c0"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const tableBody = document.getElementById("showtimeTable");

        // Load danh s√°ch su·∫•t chi·∫øu
        function loadShowtimes() {
            tableBody.innerHTML = "";
            db.collection("showtimes").get().then(snapshot => {
                snapshot.forEach(doc => {
                    const showtime = doc.data();
                    const row = `
            <tr>
              <td>${showtime.movieName}</td>
              <td>${showtime.date}</td>
              <td>${showtime.time}</td>
              <td>${showtime.room}</td>
              <td>${showtime.price}ƒë</td>
              <td>
                <button class="btn-edit" onclick="editShowtime('${doc.id}','${showtime.movieName}','${showtime.date}','${showtime.time}','${showtime.room}','${showtime.price}')">S·ª≠a</button>
                <button class="btn-delete" onclick="deleteShowtime('${doc.id}')">X√≥a</button>
              </td>
            </tr>
          `;
                    tableBody.innerHTML += row;
                });
            });
        }

        // L∆∞u (th√™m m·ªõi / c·∫≠p nh·∫≠t)
        document.getElementById("saveBtn").addEventListener("click", () => {
            const id = document.getElementById("showtimeId").value;
            const movieName = document.getElementById("movieName").value;
            const date = document.getElementById("date").value;
            const time = document.getElementById("time").value;
            const room = document.getElementById("room").value;
            const price = document.getElementById("price").value;

            if (!movieName || !date || !time || !room || !price) {
                alert("Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin!");
                return;
            }

            const data = { movieName, date, time, room, price: parseInt(price) };

            if (id) {
                db.collection("showtimes").doc(id).update(data).then(() => {
                    alert("C·∫≠p nh·∫≠t th√†nh c√¥ng!");
                    loadShowtimes();
                    resetForm();
                });
            } else {
                db.collection("showtimes").add(data).then(() => {
                    alert("Th√™m th√†nh c√¥ng!");
                    loadShowtimes();
                    resetForm();
                });
            }
        });

        // S·ª≠a
        function editShowtime(id, movieName, date, time, room, price) {
            document.getElementById("showtimeId").value = id;
            document.getElementById("movieName").value = movieName;
            document.getElementById("date").value = date;
            document.getElementById("time").value = time;
            document.getElementById("room").value = room;
            document.getElementById("price").value = price;
        }

        // X√≥a
        function deleteShowtime(id) {
            if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a su·∫•t chi·∫øu n√†y?")) {
                db.collection("showtimes").doc(id).delete().then(() => {
                    alert("X√≥a th√†nh c√¥ng!");
                    loadShowtimes();
                });
            }
        }

        // Reset form
        function resetForm() {
            document.getElementById("showtimeId").value = "";
            document.getElementById("movieName").value = "";
            document.getElementById("date").value = "";
            document.getElementById("time").value = "";
            document.getElementById("room").value = "";
            document.getElementById("price").value = "";
        }

        // G·ªçi load l·∫ßn ƒë·∫ßu
        loadShowtimes();
    </script>
</body>

</html>