<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω v√©</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            margin: 0;
            font-family: "Segoe UI", sans-serif;
            background: #111;
            color: #fff;
            display: flex;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            height: 100vh;
            background: linear-gradient(180deg, #8B0000, #111);
            padding: 20px;
            box-sizing: border-box;
        }

        .sidebar h2 {
            color: #fff;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
        }

        .sidebar ul li {
            margin: 15px 0;
        }

        .sidebar ul li a {
            color: #fff;
            text-decoration: none;
            font-weight: bold;
        }

        .sidebar ul li a:hover {
            color: #e50914;
        }

        /* Main content */
        .main {
            flex: 1;
            padding: 20px;
        }

        .form-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .form-container input {
            padding: 10px;
            border-radius: 8px;
            border: none;
            outline: none;
            flex: 1;
        }

        .btn-add {
            padding: 10px 20px;
            background: #e50914;
            border: none;
            border-radius: 8px;
            color: #fff;
            cursor: pointer;
            font-weight: bold;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            color: #fff;
        }

        th,
        td {
            padding: 12px;
            text-align: center;
        }

        th {
            background-color: #b22222;
        }

        tr:nth-child(even) {
            background-color: #222;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            color: #fff;
            font-weight: bold;
        }

        .btn-edit {
            background-color: #f39c12;
        }

        .btn-delete {
            background-color: #e50914;
            margin-left: 5px;
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <h2>üé¨ Cinema Admin</h2>
        <ul>
            <li><a href="admin.html">Admin</a></li>
            <li><a href="movies.html">Phim</a></li>
            <li><a href="shows.html">Su·∫•t chi·∫øu</a></li>
            <li><a href="tickets.html">V√©</a></li>
            <li><a href="index.html">üåê Trang web ch√≠nh</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main">
        <h2>üéüÔ∏è Qu·∫£n l√Ω v√©</h2>
        <div class="form-container">
            <input type="text" id="customer" placeholder="T√™n kh√°ch h√†ng">
            <input type="text" id="movie" placeholder="T√™n phim">
            <input type="text" id="datetime" placeholder="Ng√†y gi·ªù (2025-09-12 20:00)">
            <input type="text" id="room" placeholder="Ph√≤ng">
            <input type="text" id="seat" placeholder="Gh·∫ø">
            <input type="number" id="price" placeholder="Gi√° v√©">
            <button class="btn-add" onclick="addTicket()">Th√™m v√©</button>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Kh√°ch h√†ng</th>
                    <th>Phim</th>
                    <th>Ng√†y gi·ªù</th>
                    <th>Ph√≤ng</th>
                    <th>Gh·∫ø</th>
                    <th>Gi√° v√©</th>
                    <th>H√†nh ƒë·ªông</th>
                </tr>
            </thead>
            <tbody id="ticket-list">
            </tbody>
        </table>
    </div>

    <!-- Firebase Script -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // üî• Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDlne_gt7K1kWxTbBKcAD2Onvy7B8OUcaA",
            authDomain: "vghh-7999b.firebaseapp.com",
            projectId: "vghh-7999b",
            storageBucket: "vghh-7999b.firebasestorage.app",
            messagingSenderId: "374520262209",
            appId: "1:374520262209:web:7118e642efe315baa520c0",
            measurementId: "G-D3ZEDNBQ7C"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const ticketsRef = collection(db, "tickets");

        const ticketList = document.getElementById("ticket-list");

        // üìå Hi·ªÉn th·ªã danh s√°ch v√© realtime
        onSnapshot(ticketsRef, (snapshot) => {
            ticketList.innerHTML = "";
            snapshot.forEach((docSnap) => {
                const data = docSnap.data();
                ticketList.innerHTML += `
          <tr>
            <td>${data.customer}</td>
            <td>${data.movie}</td>
            <td>${data.datetime}</td>
            <td>${data.room}</td>
            <td>${data.seat}</td>
            <td>${data.price} ƒë</td>
            <td>
              <button class="btn btn-edit" onclick="editTicket('${docSnap.id}', '${data.customer}', '${data.movie}', '${data.datetime}', '${data.room}', '${data.seat}', '${data.price}')">S·ª≠a</button>
              <button class="btn btn-delete" onclick="deleteTicket('${docSnap.id}')">X√≥a</button>
            </td>
          </tr>
        `;
            });
        });

        // üìå Th√™m v√©
        window.addTicket = async () => {
            const customer = document.getElementById("customer").value;
            const movie = document.getElementById("movie").value;
            const datetime = document.getElementById("datetime").value;
            const room = document.getElementById("room").value;
            const seat = document.getElementById("seat").value;
            const price = document.getElementById("price").value;

            if (customer && movie) {
                await addDoc(ticketsRef, { customer, movie, datetime, room, seat, price });
                document.getElementById("customer").value = "";
                document.getElementById("movie").value = "";
                document.getElementById("datetime").value = "";
                document.getElementById("room").value = "";
                document.getElementById("seat").value = "";
                document.getElementById("price").value = "";
            }
        };

        // üìå S·ª≠a v√©
        window.editTicket = async (id, customer, movie, datetime, room, seat, price) => {
            const newCustomer = prompt("T√™n kh√°ch h√†ng:", customer);
            const newMovie = prompt("T√™n phim:", movie);
            const newDatetime = prompt("Ng√†y gi·ªù:", datetime);
            const newRoom = prompt("Ph√≤ng:", room);
            const newSeat = prompt("Gh·∫ø:", seat);
            const newPrice = prompt("Gi√° v√©:", price);

            const ticketRef = doc(db, "tickets", id);
            await updateDoc(ticketRef, {
                customer: newCustomer,
                movie: newMovie,
                datetime: newDatetime,
                room: newRoom,
                seat: newSeat,
                price: newPrice
            });
        };

        // üìå X√≥a v√©
        window.deleteTicket = async (id) => {
            const confirmDelete = confirm("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a v√© n√†y?");
            if (confirmDelete) {
                await deleteDoc(doc(db, "tickets", id));
            }
        };
    </script>
</body>

</html>